<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mowing Man: The Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #222;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            touch-action: none; /* Prevent browser zooming/scrolling */
        }

        #game-container {
            position: relative;
            margin-top: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: 4px solid #444;
        }

        canvas {
            display: block;
            background-color: #2e8b57; /* SeaGreen base */
        }

        /* UI Overlay */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            box-sizing: border-box;
            pointer-events: none;
        }

        /* Controls */
        #controls {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 60px 60px 60px;
            grid-template-rows: 60px 60px;
            gap: 10px;
        }

        .btn {
            background: #444;
            border-radius: 50%;
            border: 2px solid #666;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            user-select: none;
            cursor: pointer;
            active: #666;
            -webkit-tap-highlight-color: transparent;
        }
        
        .btn:active {
            background-color: #666;
        }

        /* Directional mapping */
        #up { grid-column: 2; grid-row: 1; }
        #left { grid-column: 1; grid-row: 2; }
        #down { grid-column: 2; grid-row: 2; }
        #right { grid-column: 3; grid-row: 2; }

    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="ui-layer">
            <span id="score">Mowed: 0%</span>
            <span id="level">Level: 1</span>
        </div>
    </div>

    <!-- Mobile Controls -->
    <div id="controls">
        <div class="btn" id="up">▲</div>
        <div class="btn" id="left">◀</div>
        <div class="btn" id="down">▼</div>
        <div class="btn" id="right">▶</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Game Constants
        const TILE_SIZE = 20;
        const GRID_W = 20; // Width in tiles
        const GRID_H = 20; // Height in tiles
        
        // Setup Canvas Size
        canvas.width = TILE_SIZE * GRID_W;
        canvas.height = TILE_SIZE * GRID_H;

        // Colors
        const COLOR_GRASS_UNCUT = '#228B22'; // ForestGreen
        const COLOR_GRASS_CUT = '#32CD32';   // LimeGreen
        const COLOR_MOWER = '#FF4500';       // OrangeRed
        const COLOR_ROCK = '#808080';        // Gray
        const COLOR_FLOWER = '#FF69B4';      // Pink

        // State
        let grid = [];
        let mower = { x: 0, y: 0, dirX: 0, dirY: 0, speed: 5, frameCount: 0 };
        let rocks = [];
        let flowers = [];
        let score = 0;
        let totalGrass = 0;
        let gameOver = false;

        // Init Game
        function initGame() {
            grid = [];
            rocks = [];
            flowers = [];
            score = 0;
            totalGrass = GRID_W * GRID_H;
            
            // Create Grid
            for (let y = 0; y < GRID_H; y++) {
                let row = [];
                for (let x = 0; x < GRID_W; x++) {
                    row.push(1); // 1 = Uncut, 0 = Cut
                }
                grid.push(row);
            }

            // Place Mower
            mower.x = 0;
            mower.y = 0;
            mower.dirX = 0;
            mower.dirY = 0;
            
            // Mark starting spot as cut
            grid[0][0] = 0; 

            // Add obstacles
            for(let i=0; i<5; i++) spawnItem(rocks, 'rock');
            for(let i=0; i<3; i++) spawnItem(flowers, 'flower');

            gameOver = false;
            gameLoop();
        }

        function spawnItem(array, type) {
            let placed = false;
            while(!placed) {
                let rx = Math.floor(Math.random() * GRID_W);
                let ry = Math.floor(Math.random() * GRID_H);
                // Don't place on mower start
                if(rx === 0 && ry === 0) continue;
                
                array.push({x: rx, y: ry, type: type});
                placed = true;
            }
        }

        // Input Handling
        function setDir(dx, dy) {
            mower.dirX = dx;
            mower.dirY = dy;
        }

        document.addEventListener('keydown', (e) => {
            if(gameOver) { initGame(); return; }
            switch(e.key) {
                case 'ArrowUp': setDir(0, -1); break;
                case 'ArrowDown': setDir(0, 1); break;
                case 'ArrowLeft': setDir(-1, 0); break;
                case 'ArrowRight': setDir(1, 0); break;
            }
        });

        // Touch bindings
        const buttons = {
            'up': {x: 0, y: -1},
            'down': {x: 0, y: 1},
            'left': {x: -1, y: 0},
            'right': {x: 1, y: 0}
        };

        Object.keys(buttons).forEach(id => {
            const btn = document.getElementById(id);
            btn.addEventListener('pointerdown', (e) => {
                e.preventDefault();
                if(gameOver) initGame();
                else setDir(buttons[id].x, buttons[id].y);
            });
        });

        function update() {
            if(gameOver) return;

            // Slow down movement to make it controllable (move every X frames)
            mower.frameCount++;
            if(mower.frameCount < mower.speed) return;
            mower.frameCount = 0;

            if (mower.dirX === 0 && mower.dirY === 0) return;

            let nextX = mower.x + mower.dirX;
            let nextY = mower.y + mower.dirY;

            // Boundary Check
            if (nextX < 0 || nextX >= GRID_W || nextY < 0 || nextY >= GRID_H) {
                mower.dirX = 0; 
                mower.dirY = 0;
                return;
            }

            // Rock Collision
            for (let r of rocks) {
                if (r.x === nextX && r.y === nextY) {
                    // Clang! Stop.
                    mower.dirX = 0;
                    mower.dirY = 0;
                    return;
                }
            }

            // Flower Collision (GameOver?)
            for (let f of flowers) {
                if (f.x === nextX && f.y === nextY) {
                    gameOver = true;
                    // Using simple alert for game over
                    setTimeout(() => alert("You mowed a flower! Game Over. Press any key or button to restart."), 10);
                    return;
                }
            }

            // Move
            mower.x = nextX;
            mower.y = nextY;

            // Cut Grass
            if (grid[mower.y][mower.x] === 1) {
                grid[mower.y][mower.x] = 0;
                score++;
                document.getElementById('score').innerText = `Mowed: ${Math.floor((score / totalGrass) * 100)}%`;
            }
        }

        function draw() {
            // Draw Grass
            for (let y = 0; y < GRID_H; y++) {
                for (let x = 0; x < GRID_W; x++) {
                    ctx.fillStyle = grid[y][x] === 1 ? COLOR_GRASS_UNCUT : COLOR_GRASS_CUT;
                    ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                    // Add subtle grid line
                    ctx.strokeStyle = '#2a7a4a';
                    ctx.strokeRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                }
            }

            // Draw Rocks
            ctx.fillStyle = COLOR_ROCK;
            for (let r of rocks) {
                ctx.beginPath();
                ctx.arc(r.x * TILE_SIZE + TILE_SIZE/2, r.y * TILE_SIZE + TILE_SIZE/2, TILE_SIZE/3, 0, Math.PI * 2);
                ctx.fill();
            }

            // Draw Flowers
            ctx.fillStyle = COLOR_FLOWER;
            for (let f of flowers) {
                ctx.beginPath();
                let cx = f.x * TILE_SIZE + TILE_SIZE/2;
                let cy = f.y * TILE_SIZE + TILE_SIZE/2;
                ctx.arc(cx, cy, TILE_SIZE/4, 0, Math.PI * 2);
                ctx.fill();
            }

            // Draw Mower
            ctx.fillStyle = COLOR_MOWER;
            ctx.fillRect(mower.x * TILE_SIZE + 2, mower.y * TILE_SIZE + 2, TILE_SIZE - 4, TILE_SIZE - 4);
            
            // Draw Mower Handle (Direction indicator)
            ctx.fillStyle = '#000';
            let mx = mower.x * TILE_SIZE + TILE_SIZE/2;
            let my = mower.y * TILE_SIZE + TILE_SIZE/2;
            if (mower.dirX === 1) ctx.fillRect(mx, my-2, 8, 4);
            if (mower.dirX === -1) ctx.fillRect(mx-8, my-2, 8, 4);
            if (mower.dirY === 1) ctx.fillRect(mx-2, my, 4, 8);
            if (mower.dirY === -1) ctx.fillRect(mx-2, my-8, 4, 8);

        }

        function gameLoop() {
            update();
            draw();
            if (!gameOver) requestAnimationFrame(gameLoop);
        }

        // Start
        initGame();

    </script>
</body>
</html>

      
